# Парсер Вконтакте

Парсер для поиска постов и комментариев в группах по ключевым словам

  - Ищет комментарии в обсуждениях групп
  - Ищет комментарии в записях на стене
  - Ищет записи на стене
  - Отправляет результат на почту или в текстовый файл

### Установка
Склонируйте репозиторий, зайтите в рабочую папку, установите нужные гемы.

```sh
$ git clone git@github.com:fixel92/ruby-vk-parser.git
$ cd ruby-vk-parser
$ bundle install
```
### Настройка
Перед запуском парсера, Вам необходимо подготовиться.
##### Для работы Вам нужен
  - Сервисный токен.
  - Список групп для парсинга
  - Список ключевых слов
  - Список Анти-ключевых слов
  - Почта для отправки результата *
  - Почта для приема результата *
  
*Можно не использовать почту и получать результат в виде файла txt или html.

#### Получаем сервисный токен Вконтакте
https://vk.com/apps?act=manage - переходим по этой ссылке  и нажимаем **создать приложение**.

![alt text](https://i.ibb.co/G9TS691/2020-01-30-09-22-50.png)

Во вкладке **Настройки** скопируйте сервисный ключ доступа. Без него не получится использовать методы API для получения постов, комментариев и обсуждений.

![alt text](https://i.ibb.co/8NFmDDF/2020-01-30-09-26-19.png)
  
Теперь вставляем полученый сервисный ключ в созданный файл ```.env``` . Пример его содержимого Вы найдете в файле ```.env.sample ```

Файл ```.env.sample```

| Переменная | Значение |
| ------ | ------ |
| EMAIL_TO | Почта на которую будут отправляться результаты |
| EMAIL_FROM | Почта с которой мы будем отправлять результаты(используем SMTP) |
| EMAIL_FROM_PASSWORD | Пароль от почты отправителя |
| SERVICE_TOKEN_VK | Сервисный ключ доступа |

#### Заполняем ключевые слова и ссылки на группы

В папке ``` data ```

| Файл | Назначение |
| ------ | ------ |
| anti_keywords.txt | Анти-ключевые слова. Отсеивают записи по не нужным ключам. Вы можете указывать не только слова, но и фразы.  |
| keywords.txt | Ключевые слова. Парсер ищет записи по этим ключам. Вы можете указывать не только слова, но и фразы. |
| urls.txt | Список ссылкок на группы в формате ***https://vk.com/batumihelp*** (Группы должны быть с открытой стеной) |
| data.db | База данных Sqlite3, которая хранит уже найденные ранее записи. |

Заполните файлы с ключами и ссылками на группы. Для удобства там оставлены примеры заполненных файлов. Обратите внимание, что Вам, возможно, придется редактировать и дополнять как ключевые так и антиключевые слова, до тех пор пока Вы не настроите поиск на нужные Вам результаты.

#### Настройка почты
Создайте новую почту gmail. ***НЕ ИСПОЛЬЗУЙТЕ ЛИЧНУЮ ПОЧТУ!!!***
Если Вы хотите получать результаты на почту, тогда Вам нужно настроить почту (я использую gmail) для работы по протоколу SMTP. https://support.google.com/mail/answer/7126229?hl=ru

Кроме этого на странице https://myaccount.google.com/security разрешите доступ ненадежным приложениям.
**Будьте внимательны! Проверьте, что почта совпадает с аккаунтом!!!**

Первое письмо отправленное таким образом, гугл может не отправить. Но пришлет Вам письмо с вопросом, Вы ли пытались подключиться к сервису? Соглашаетесь и теперь результаты парсинга будут приходить на указанную почту в ```.env``` файле.

В файле ```app.rb``` вызовите метод ```send_email ``` вместо ```send_in_html```
```sh
output.send_email
```

### Типы вывода результатов
| Метод | Назначение |
| ------ | ------ |
| send_email | Отправляет письмо с результатами  |
| send_in_txt | Создает файл my_output.txt с результатами |
| send_in_html | Создает файл my_output.html с результатами |

Если вывод в почту не нужен, выбирайте вывод в html. Это удобнее. Открыв файл в браузере вы нажимая на ссылки сразу будете попадать на запись или комментарий.

### Запуск

```sh
$ ruby app.rb
```

### Результат
Вывод на почту

![alt text](https://i.ibb.co/gwRNrZV/2020-01-30-11-02-30.png)

Вывод в html страницу

![alt text](https://i.ibb.co/4NwkTVP/2020-01-30-11-15-28.png)

Вывод в txt файл

![alt text](https://i.ibb.co/d4bLCGY/2020-01-30-11-33-18.png)


### Todos

 - Поиск комментариев под фото
 - Переписать запросы к API и ускорить поиск через execute
 - Вывод в телеграм
 - Получение ключевых слов из Google  Sheets 

License
----

MIT

**Free Software, Hell Yeah!**
### Thanks
**Thanks to https://dillinger.io/ for README**
